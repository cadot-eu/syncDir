#!/bin/bash

# Script de mise √† jour de syncDir
# Met √† jour depuis le d√©p√¥t git et installe dans /usr/local/bin/

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

echo "=== Mise √† jour de syncDir ==="
echo ""

# V√©rifier qu'on est bien dans un d√©p√¥t git
if [ ! -d ".git" ]; then
    echo "Erreur: Ce r√©pertoire n'est pas un d√©p√¥t git"
    exit 1
fi

# Git pull
echo "üì• R√©cup√©ration des derni√®res modifications..."
git pull

if [ $? -ne 0 ]; then
    echo "‚ùå Erreur lors du git pull"
    exit 1
fi

echo "‚úÖ D√©p√¥t mis √† jour"
echo ""

# Copier le script dans /usr/local/bin/
echo "üì¶ Installation de syncDir dans /usr/local/bin/..."
sudo cp syncDir /usr/local/bin/

if [ $? -ne 0 ]; then
    echo "‚ùå Erreur lors de la copie"
    exit 1
fi

echo "‚úÖ syncDir install√© avec succ√®s"
echo ""

# Cr√©er le r√©pertoire de logs s'il n'existe pas
echo "üìÅ V√©rification du r√©pertoire de logs..."
if [ ! -d "$HOME/syncDir_log" ]; then
    mkdir -p "$HOME/syncDir_log"
    echo "‚úÖ R√©pertoire ~/syncDir_log cr√©√©"
else
    echo "‚úÖ R√©pertoire ~/syncDir_log existe d√©j√†"
fi
echo ""

# Afficher la version
if command -v syncDir &> /dev/null; then
    echo "üìç Emplacement: $(which syncDir)"
    echo ""
    echo "=== Mise √† jour termin√©e avec succ√®s ==="
else
    echo "‚ö†Ô∏è  Avertissement: syncDir n'est pas dans le PATH"
fi
